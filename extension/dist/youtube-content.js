(()=>{"use strict";console.log("LockIn YouTube content script loaded");let e=null;function t(){const t=new URL(window.location.href).searchParams.get("v");t&&t!==e&&(e=t,async function(e){if(function(){try{return!!chrome?.runtime?.id}catch{return!1}}())try{const{preferences:t}=await chrome.storage.local.get("preferences"),n=document.querySelector("h1.ytd-video-primary-info-renderer")?.textContent||document.querySelector("h1.title")?.textContent||"",o=document.querySelector("ytd-channel-name a")?.textContent||document.querySelector("#channel-name")?.textContent||"",i=document.querySelector("ytd-text-inline-expander")?.textContent||"",r=await chrome.runtime.sendMessage({type:"CLASSIFY_CONTENT",data:{url:window.location.href,videoId:e,title:n.trim(),channelName:o.trim(),description:i.trim().substring(0,500)}});r&&!r.error&&(t?.youtubeBlockedCategories||[]).includes(r.category)&&function(e){const t=document.querySelector("video");if(t){t.pause(),t.muted=!0,t.volume=0,t.src="",t.load();const e=e=>(e.preventDefault(),e.stopPropagation(),t.pause(),!1);t.addEventListener("play",e),t.addEventListener("playing",e),t.addEventListener("canplay",e);const n=setInterval(()=>{t.paused||(t.pause(),t.muted=!0,t.volume=0)},100);t._blockInterval=n}const n=document.querySelector("#movie_player")||document.querySelector(".html5-video-player");if(n){const t=document.createElement("div");t.id="lockin-block-overlay",t.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 99999;\n      color: white;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      pointer-events: all;\n    ";const o=e?`<p style="font-size: 16px; opacity: 0.8; margin-top: 10px;">Category: <strong>${e}</strong></p>`:"";t.innerHTML=`\n      <div style="text-align: center; padding: 40px;">\n        <h1 style="font-size: 36px; margin-bottom: 20px;">ðŸš« Content Blocked</h1>\n        <p style="font-size: 18px; opacity: 0.9;">This ${e||"entertainment"} video is blocked by LockIn.</p>\n        ${o}\n        <p style="font-size: 14px; margin-top: 20px; opacity: 0.7;">\n          You can adjust blocked categories in your dashboard settings.\n        </p>\n      </div>\n    `,t.addEventListener("click",e=>(e.preventDefault(),e.stopPropagation(),!1)),n.style.position="relative";const i=document.getElementById("lockin-block-overlay");i&&i.remove(),n.appendChild(t)}}(r.category)}catch(e){e instanceof Error&&e.message.includes("Extension context invalidated")?console.log("LockIn: Extension was reloaded"):console.error("Failed to classify YouTube video:",e)}else console.log("LockIn: Extension context invalidated, skipping classification")}(t))}setTimeout(t,2e3);let n=window.location.href;new MutationObserver(()=>{window.location.href!==n&&(n=window.location.href,setTimeout(t,1e3))}).observe(document.body,{childList:!0,subtree:!0})})();